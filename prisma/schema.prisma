generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  email             String             @unique
  name              String?
  password          String
  image             String?
  role              UserRole           @default(TRAINER)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  theme             String?            @default("default")
  createdExercises  Exercise[]
  favoriteExercises FavoriteExercise[]
  teams             TeamMember[]
  createdTeams      Team[]             @relation("TeamCreator")
  createdWorkouts   Workout[]

  @@map("users")
}

model Sport {
  id        String     @id @default(cuid())
  name      String     @unique
  slug      String     @unique
  icon      String?
  active    Boolean    @default(true)
  createdAt DateTime   @default(now())
  exercises Exercise[]
  teams     Team[]

  @@map("sports")
}

model Team {
  id                    String            @id @default(cuid())
  name                  String
  sportId               String
  description           String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  creatorId             String
  volleybalNlApiId      String?
  volleybalNlCategory   String?
  volleybalNlClubId     String?
  volleybalNlTeamNumber Int?
  members               TeamMember[]
  creator               User              @relation("TeamCreator", fields: [creatorId], references: [id])
  sport                 Sport             @relation(fields: [sportId], references: [id])
  trainingSessions      TrainingSession[]
  workouts              Workout[]

  @@map("teams")
}

model TeamMember {
  id         String               @id @default(cuid())
  teamId     String
  userId     String
  role       MemberRole           @default(PLAYER)
  number     Int?
  position   String?
  joinedAt   DateTime             @default(now())
  team       Team                 @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user       User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  attendance TrainingAttendance[]

  @@unique([teamId, userId, role])
  @@map("team_members")
}

model Exercise {
  id               String             @id @default(cuid())
  title            String
  description      String?
  duration         Int?
  difficulty       Difficulty         @default(MEDIUM)
  sportId          String
  categoryId       String?
  creatorId        String
  isPublic         Boolean            @default(false)
  diagram          String?
  videoUrl         String?
  tags             String[]
  views            Int                @default(0)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  materials        Json?
  playerMax        Int?
  playerMin        Int?
  skillLevel       SkillLevel?
  techniques       String[]           @default([])
  category         ExerciseCategory?  @relation(fields: [categoryId], references: [id])
  creator          User               @relation(fields: [creatorId], references: [id])
  sport            Sport              @relation(fields: [sportId], references: [id])
  favorites        FavoriteExercise[]
  sessionExercises SessionExercise[]
  workoutExercises WorkoutExercise[]

  @@index([sportId])
  @@index([creatorId])
  @@index([isPublic])
  @@map("exercises")
}

model ExerciseCategory {
  id        String     @id @default(cuid())
  name      String
  slug      String     @unique
  createdAt DateTime   @default(now())
  exercises Exercise[]

  @@map("exercise_categories")
}

model FavoriteExercise {
  id         String   @id @default(cuid())
  userId     String
  exerciseId String
  createdAt  DateTime @default(now())
  exercise   Exercise @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, exerciseId])
  @@map("favorite_exercises")
}

model Workout {
  id               String            @id @default(cuid())
  title            String
  description      String?
  totalDuration    Int?
  sportId          String?
  creatorId        String
  isPublic         Boolean           @default(false)
  teamId           String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  endTime          DateTime?
  startTime        DateTime?
  diagram          String?
  trainingSessions TrainingSession[]
  exercises        WorkoutExercise[]
  creator          User              @relation(fields: [creatorId], references: [id])
  team             Team?             @relation(fields: [teamId], references: [id])

  @@index([creatorId])
  @@index([teamId])
  @@index([isPublic])
  @@map("workouts")
}

model WorkoutExercise {
  id         String   @id @default(cuid())
  workoutId  String
  exerciseId String
  order      Int
  duration   Int?
  notes      String?
  exercise   Exercise @relation(fields: [exerciseId], references: [id])
  workout    Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@unique([workoutId, order])
  @@map("workout_exercises")
}

model TrainingSession {
  id          String               @id @default(cuid())
  teamId      String
  workoutId   String?
  title       String
  description String?
  scheduledAt DateTime
  duration    Int?
  location    String?
  status      SessionStatus        @default(SCHEDULED)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  exercises   SessionExercise[]
  attendance  TrainingAttendance[]
  team        Team                 @relation(fields: [teamId], references: [id], onDelete: Cascade)
  workout     Workout?             @relation(fields: [workoutId], references: [id])

  @@index([teamId])
  @@index([scheduledAt])
  @@map("training_sessions")
}

model TrainingAttendance {
  id        String           @id @default(cuid())
  sessionId String
  memberId  String
  status    AttendanceStatus @default(PENDING)
  notes     String?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  member    TeamMember       @relation(fields: [memberId], references: [id], onDelete: Cascade)
  session   TrainingSession  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, memberId])
  @@map("training_attendance")
}

model SessionExercise {
  id         String          @id @default(cuid())
  sessionId  String
  exerciseId String
  order      Int
  duration   Int?
  notes      String?
  createdAt  DateTime        @default(now())
  exercise   Exercise        @relation(fields: [exerciseId], references: [id])
  session    TrainingSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, order])
  @@index([sessionId])
  @@map("session_exercises")
}

enum UserRole {
  TRAINER
  ADMIN
  PLAYER
}

enum MemberRole {
  COACH
  TRAINER
  ASSISTANT_COACH
  PLAYER
  PARENT
  VOLUNTEER
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum SessionStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum AttendanceStatus {
  PENDING
  PRESENT
  ABSENT
  LATE
  EXCUSED
}
